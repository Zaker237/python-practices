{% extends 'base.html' %}
{% block content %}
<div class="flex flex-col bg-gray-50 h-4/5 min-h-4/5 w-4/5 items-stretch border-2 border-stone-900">
    <h2>Chat Room {{code}}</h2>
    <div id="messages" class="flex-1 w-full overflow-y-scroll">
    </div>
    <div class="flex w-full">
        <input
            class="flex-1 p-2"
            type="text"
            row=3
            name="message"
            placeholder="Message"
            id="message"
        />
        <button
            class="bg-green-700 py-2 px-16 font-bold"
            type="button"
            name="send"
            id="send-btn"
            onclick="sendMessage()"
        >Send</button>
    </div>
</div>
<script type="text/javascript">
    var socketio = io();
    const messages = document.getElementById("messages");

    const createMessage = (name, msg) => {
        const content = `
            <div class="flex items-center justify-between pl-4 pr-4">
                <span>
                    <strong>${name}</strong>: ${msg}   
                </span>
                <span class="text-sm text-gray-800">
                    ${new Date().toLocaleString()}
                </span>
            </div>
        `;
        messages.innerHTML += content;
    }

    socketio.on("message", (data) => {
        createMessage(data.name, data.message);
    });

    const sendMessage = () => {
        const message = document.getElementById("message");
        if (!message.value) return
        socketio.emit("message", {data: message.value});
        message.value = "";
    }
</script>
{% for msg in messages %}
    <script type="text/javascript">
        createMessage("{{msg.name}}", "{{msg.message}}");
    </script>
{% endfor %}
{% endblock %}